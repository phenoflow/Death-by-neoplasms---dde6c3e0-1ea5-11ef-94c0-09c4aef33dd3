# John, A, McGregor, J., Jones, I., Lee, S. C., Walters, J. T. R., Owen, M. J., O'Donovan, M., DelPozo-Banos, M., Berridge, D., and Lloyd, K., 2024.

import sys, csv, re

codes = [{"code":"C57.7","system":"icd10"},{"code":"C92.9","system":"icd10"},{"code":"C49.6","system":"icd10"},{"code":"D29.9","system":"icd10"},{"code":"C63.7","system":"icd10"},{"code":"D41.9","system":"icd10"},{"code":"D28.9","system":"icd10"},{"code":"C32.9","system":"icd10"},{"code":"D33.9","system":"icd10"},{"code":"D43.2","system":"icd10"},{"code":"C02.9","system":"icd10"},{"code":"C13.9","system":"icd10"},{"code":"D01.9","system":"icd10"},{"code":"D33.2","system":"icd10"},{"code":"D21.6","system":"icd10"},{"code":"C57.0","system":"icd10"},{"code":"D30.9","system":"icd10"},{"code":"D01.7","system":"icd10"},{"code":"C16.9","system":"icd10"},{"code":"D48.1","system":"icd10"},{"code":"D42.9","system":"icd10"},{"code":"D17.9","system":"icd10"},{"code":"C57.3","system":"icd10"},{"code":"C68","system":"icd10"},{"code":"C70.9","system":"icd10"},{"code":"D48.9","system":"icd10"},{"code":"C91.9","system":"icd10"},{"code":"C18.9","system":"icd10"},{"code":"D21.9","system":"icd10"},{"code":"C04.9","system":"icd10"},{"code":"D43.9","system":"icd10"},{"code":"C88.9","system":"icd10"},{"code":"C03.9","system":"icd10"},{"code":"D01","system":"icd10"},{"code":"D10.3","system":"icd10"},{"code":"C11.9","system":"icd10"},{"code":"D36.9","system":"icd10"},{"code":"C85","system":"icd10"},{"code":"C45.9","system":"icd10"},{"code":"C85.1","system":"icd10"},{"code":"C21.0","system":"icd10"},{"code":"C00.9","system":"icd10"},{"code":"C72.9","system":"icd10"},{"code":"D40.9","system":"icd10"},{"code":"D28.0","system":"icd10"},{"code":"D36","system":"icd10"},{"code":"D07.6","system":"icd10"},{"code":"D25.9","system":"icd10"},{"code":"C85.0","system":"icd10"},{"code":"D09","system":"icd10"},{"code":"C57","system":"icd10"},{"code":"C85.9","system":"icd10"},{"code":"C34.9","system":"icd10"},{"code":"D48.4","system":"icd10"},{"code":"C55.X","system":"icd10"},{"code":"C95","system":"icd10"},{"code":"C63.9","system":"icd10"},{"code":"D48.6","system":"icd10"},{"code":"C78.3","system":"icd10"},{"code":"C44.9","system":"icd10"},{"code":"C60.9","system":"icd10"},{"code":"C06","system":"icd10"},{"code":"D14.4","system":"icd10"},{"code":"C02.1","system":"icd10"},{"code":"D32.9","system":"icd10"},{"code":"C38.3","system":"icd10"},{"code":"D07.1","system":"icd10"},{"code":"C25.9","system":"icd10"},{"code":"D09.1","system":"icd10"},{"code":"D48.3","system":"icd10"},{"code":"D12.6","system":"icd10"},{"code":"D10.9","system":"icd10"},{"code":"C50.9","system":"icd10"},{"code":"D07","system":"icd10"},{"code":"D05.9","system":"icd10"},{"code":"D48.5","system":"icd10"},{"code":"D39.9","system":"icd10"},{"code":"D48","system":"icd10"},{"code":"C05.9","system":"icd10"},{"code":"D22.9","system":"icd10"},{"code":"C10.9","system":"icd10"},{"code":"C06.0","system":"icd10"},{"code":"D36.7","system":"icd10"},{"code":"D28.7","system":"icd10"},{"code":"C46.9","system":"icd10"},{"code":"C95.9","system":"icd10"},{"code":"C71.9","system":"icd10"},{"code":"D02.4","system":"icd10"},{"code":"C31.9","system":"icd10"},{"code":"D09.7","system":"icd10"},{"code":"C63","system":"icd10"},{"code":"C81.9","system":"icd10"},{"code":"C48.2","system":"icd10"},{"code":"D26.9","system":"icd10"},{"code":"C49.9","system":"icd10"},{"code":"C78.8","system":"icd10"},{"code":"C43.9","system":"icd10"},{"code":"D23.9","system":"icd10"},{"code":"C06.9","system":"icd10"},{"code":"D07.3","system":"icd10"},{"code":"C79.4","system":"icd10"},{"code":"D46.9","system":"icd10"},{"code":"D01.2","system":"icd10"},{"code":"C02","system":"icd10"},{"code":"C06.2","system":"icd10"},{"code":"C85.7","system":"icd10"},{"code":"C15.9","system":"icd10"},{"code":"D28","system":"icd10"},{"code":"C68.9","system":"icd10"},{"code":"D07.4","system":"icd10"},{"code":"C79.1","system":"icd10"},{"code":"D37.9","system":"icd10"},{"code":"D09.9","system":"icd10"},{"code":"C51.9","system":"icd10"},{"code":"D01.3","system":"icd10"},{"code":"C57.9","system":"icd10"},{"code":"D04.9","system":"icd10"},{"code":"C83.9","system":"icd10"},{"code":"C55","system":"icd10"},{"code":"D19.9","system":"icd10"},{"code":"D03.9","system":"icd10"},{"code":"C93.9","system":"icd10"},{"code":"C06.1","system":"icd10"},{"code":"D01.0","system":"icd10"},{"code":"C72.5","system":"icd10"},{"code":"C95.7","system":"icd10"}];
REQUIRED_CODES = 1;
with open(sys.argv[1], 'r') as file_in, open('death-by-neoplasms-potential-cases.csv', 'w', newline='') as file_out:
    csv_reader = csv.DictReader(file_in)
    csv_writer = csv.DictWriter(file_out, csv_reader.fieldnames + ["death-by-neoplasms-natural-cause-unspeci---secondary-identified"])
    csv_writer.writeheader();
    codes_identified = 0;
    for row in csv_reader:
        newRow = row.copy();
        for cell in row:
            # Iterate cell lists (e.g. codes)
            for item in re.findall(r'\(([^,]*)\,', row[cell]):
                if(item in list(map(lambda code: code['code'], codes))): codes_identified+=1;
                if(codes_identified>=REQUIRED_CODES):
                    newRow["death-by-neoplasms-natural-cause-unspeci---secondary-identified"] = "CASE";
                    break;
            if(codes_identified>=REQUIRED_CODES): break;
        if(codes_identified<REQUIRED_CODES):
            newRow["death-by-neoplasms-natural-cause-unspeci---secondary-identified"] = "UNK";
        codes_identified=0;
        csv_writer.writerow(newRow)
